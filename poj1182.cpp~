/*************************************************************************
    > File Name: poj1182.cpp
    > Author: chendi
    > Mail: chendi1995@sohu.com 
    > The compiler environment:vim + gcc
    > Created Time: 2015年04月06日 星期一 16时09分55秒
 ************************************************************************/
#include<iostream>
using namespace std;
int father[50010],rank[50010];

/*int find(int x)
{
	if(father[x]==x)
		return x;
	int tmp;
	tmp=father[x];
	father[x]=find(father[x]);
	rank[x]=(rank[x]+rank[tmp])%3;
	return father[x];

}*/
int find(int x)  
{  
    int t;   
    if(x!=father[x])  
    {  
        t = father[x];  
        father[x]= Find_set(father[x]);  
        //更新x与father[X]的关系   
        rank[x] = (rank[x]+rank[t])%3;  :
    }  
    return father[x];  
}  

void Union(int d,int x,int y)
{
	int r1,r2;
	r1=find(x);
	r2=find(y);
	father[r1]=r2;
	rank[r1]=(rank[y]-rank[x]+3+d)%3;
}

int main()
{
	int N,K;
	int i;
	int d,x,y;
	int sum=0;
	int r1,r2;
	cin >> N >> K;
	for(i=1;i<=N;i++)
	{
		father[i]=i;
		rank[i]=0;
	}
	for(i=1;i<=K;i++)
	{
		cin >> d >> x >>y;
		if(x>N ||y>N ||(d==2 && x==y))
			sum++;
		else
		{
			r1=find(x);
			r2=find(y);
			if(r1==r2)
			{
				/*if(d==0 && rank[x]!=rank[y])
					sum++;
				if(d==1&&(rank[x]==rank[y] || rank[x]==(rank[y]+1)%3))
					sum++;*/
				if((rank[x]-rank[y+3])%3!=d-1)
					sum++;
			}
			else
				Union(d-1,x,y);

		}
	}
	cout << sum << endl;
	return 0;
}
